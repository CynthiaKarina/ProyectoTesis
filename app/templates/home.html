{% extends "base_Admin.html" if admin_access else "base_home.html" %}

{% block content %}
<!-- Iconos flotantes de fondo -->
    <div class="floating-icons-container">
        <div class="floating-icon icon1">üìö</div>
        <div class="floating-icon icon2">üíª</div>
        <div class="floating-icon icon3">üéì</div>
        <div class="floating-icon icon4">‚úèÔ∏è</div>
        <div class="floating-icon icon5">üìê</div>
        <div class="floating-icon icon6">üî¨</div>
        <div class="floating-icon icon7">üé®</div>
        <div class="floating-icon icon8">üìù</div>
        <div class="floating-icon icon9">üîç</div>
        <div class="floating-icon icon10">üìä</div>
        <div class="floating-icon icon11">üí°</div>
        <div class="floating-icon icon12">‚öóÔ∏è</div>
        <div class="floating-icon icon13">üìì</div>
        <div class="floating-icon icon14">üßÆ</div>
        <div class="floating-icon icon15">üì±</div>
        <div class="floating-icon icon16">üéØ</div>
        <div class="floating-icon icon17">üìñ</div>
        <div class="floating-icon icon18">üîñ</div>
        <div class="floating-icon icon19">üìè</div>
        <div class="floating-icon icon20">üé≠</div>
    </div>
    
<!-- Contenido principal de la p√°gina de inicio -->
<div class="home-page-container">
    <!-- Secci√≥n Hero Principal -->
    <div class="home-hero-section">
        <div class="hero-content">
            <div class="hero-main">
                <h1 class="hero-title">
                    <i class="fas fa-graduation-cap"></i>
                    Portal Acad√©mico de Investigaci√≥n
                </h1>
                <p class="hero-subtitle">
                    Descubre recursos, conecta con investigadores y accede a laboratorios especializados 
                    para impulsar tu investigaci√≥n acad√©mica
                </p>
                
                <!-- B√∫squeda Global Principal -->
                <div class="global-search-container">
                    <form class="global-search-form" id="globalSearchForm">
                        <div class="search-input-group">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" 
                                   id="globalSearchInput" 
                                   class="global-search-input" 
                                   placeholder="Buscar en laboratorios, proyectos, investigadores, instituciones..."
                                   autocomplete="off">
                            <button type="button" class="clear-global-search" id="clearGlobalSearch" style="display: none;">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        
                        <div class="search-categories">
                            <label class="category-chip">
                                <input type="checkbox" name="categories" value="laboratorios" checked>
                                <span class="chip-content">
                                    <i class="fas fa-flask"></i>
                                    Laboratorios
                                </span>
                            </label>
                            <label class="category-chip">
                                <input type="checkbox" name="categories" value="proyectos" checked>
                                <span class="chip-content">
                                    <i class="fas fa-project-diagram"></i>
                                    Proyectos
                                </span>
                            </label>
                            <label class="category-chip">
                                <input type="checkbox" name="categories" value="investigadores" checked>
                                <span class="chip-content">
                                    <i class="fas fa-user-tie"></i>
                                    Investigadores
                                </span>
                            </label>
                            <label class="category-chip">
                                <input type="checkbox" name="categories" value="instituciones" checked>
                                <span class="chip-content">
                                    <i class="fas fa-university"></i>
                                    Instituciones
                                </span>
                            </label>
                            <label class="category-chip">
                                <input type="checkbox" name="categories" value="convocatorias">
                                <span class="chip-content">
                                    <i class="fas fa-bullhorn"></i>
                                    Convocatorias
                                </span>
                            </label>
                            <label class="category-chip">
                                <input type="checkbox" name="categories" value="publicaciones">
                                <span class="chip-content">
                                    <i class="fas fa-book"></i>
                                    Publicaciones
                                </span>
                            </label>
                        </div>
                        
                        <button type="submit" class="global-search-btn">
                    <i class="fas fa-search"></i>
                            <span>Buscar en Todo</span>
                </button>
                    </form>
                </div>
            </div>
            
            <!-- Estad√≠sticas Globales -->
            <div class="global-stats">
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-flask"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number">150+</div>
                        <div class="stat-label">Laboratorios</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number">300+</div>
                        <div class="stat-label">Proyectos</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-user-tie"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number">500+</div>
                        <div class="stat-label">Investigadores</div>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon">
                        <i class="fas fa-university"></i>
                    </div>
                    <div class="stat-info">
                        <div class="stat-number">50+</div>
                        <div class="stat-label">Instituciones</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Acceso R√°pido Mejorado -->
    <div class="quick-access-section">
        <div class="section-header">
            <h2>
                <i class="fas fa-rocket"></i>
                Acceso R√°pido
            </h2>
            <p>Navega directamente a las secciones m√°s utilizadas</p>
        </div>
        
        <div class="quick-access-grid">
            <a href="{{ url_for('laboratorio.index') }}" class="quick-access-card">
                <div class="card-icon">
                    <i class="fas fa-flask"></i>
                </div>
                <div class="card-content">
                    <h3>Laboratorios</h3>
                    <p>Explora laboratorios especializados</p>
                    <span class="card-badge">150+ disponibles</span>
                </div>
                <div class="card-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('home.navegar_pagina', nombre='proyectos') }}" class="quick-access-card">
                <div class="card-icon">
                    <i class="fas fa-project-diagram"></i>
                </div>
                <div class="card-content">
                    <h3>Proyectos</h3>
                    <p>Descubre proyectos de investigaci√≥n</p>
                    <span class="card-badge">300+ activos</span>
                </div>
                <div class="card-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('home.navegar_pagina', nombre='investigadores') }}" class="quick-access-card">
                <div class="card-icon">
                    <i class="fas fa-user-tie"></i>
                </div>
                <div class="card-content">
                    <h3>Investigadores</h3>
                    <p>Conecta con expertos</p>
                    <span class="card-badge">500+ perfiles</span>
                </div>
                <div class="card-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('home.navegar_pagina', nombre='instituciones') }}" class="quick-access-card">
                <div class="card-icon">
                    <i class="fas fa-university"></i>
                </div>
                <div class="card-content">
                    <h3>Instituciones</h3>
                    <p>Explora centros acad√©micos</p>
                    <span class="card-badge">50+ instituciones</span>
                </div>
                <div class="card-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('home.navegar_pagina', nombre='insumos') }}" class="quick-access-card">
                <div class="card-icon">
                    <i class="fas fa-tools"></i>
                </div>
                <div class="card-content">
                    <h3>Materiales</h3>
                    <p>Encuentra recursos y equipos</p>
                    <span class="card-badge">1000+ items</span>
                </div>
                <div class="card-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            
            <a href="{{ url_for('home.navegar_pagina', nombre='servicios') }}" class="quick-access-card">
                <div class="card-icon">
                    <i class="fas fa-cogs"></i>
                </div>
                <div class="card-content">
                    <h3>Servicios</h3>
                    <p>Accede a servicios especializados</p>
                    <span class="card-badge">100+ servicios</span>
                </div>
                <div class="card-arrow">
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
        </div>
    </div>

    <!-- Secci√≥n de Categor√≠as Destacadas -->
    <div class="featured-categories-section">
        <div class="section-header">
            <h2>
                <i class="fas fa-star"></i>
                √Åreas de Investigaci√≥n Destacadas
            </h2>
            <p>Explora las √°reas de investigaci√≥n m√°s activas</p>
        </div>
        
        <div class="categories-grid">
            <div class="category-card biotecnologia">
                <div class="category-overlay"></div>
                <div class="category-content">
                    <i class="fas fa-dna"></i>
                    <h3>Biotecnolog√≠a</h3>
                    <p>Investigaci√≥n en ciencias de la vida</p>
                    <div class="category-stats">
                        <span>45 Laboratorios</span>
                        <span>120 Proyectos</span>
                    </div>
                </div>
            </div>

            <div class="category-card informatica">
                <div class="category-overlay"></div>
                <div class="category-content">
                    <i class="fas fa-laptop-code"></i>
                    <h3>Inform√°tica</h3>
                    <p>Tecnolog√≠a y computaci√≥n</p>
                    <div class="category-stats">
                        <span>30 Laboratorios</span>
                        <span>80 Proyectos</span>
                    </div>
                </div>
            </div>

            <div class="category-card ingenieria">
                <div class="category-overlay"></div>
                <div class="category-content">
                    <i class="fas fa-cogs"></i>
                    <h3>Ingenier√≠a</h3>
                    <p>Innovaci√≥n y desarrollo</p>
                    <div class="category-stats">
                        <span>35 Laboratorios</span>
                        <span>90 Proyectos</span>
                    </div>
                </div>
            </div>

            <div class="category-card ciencias">
                <div class="category-overlay"></div>
                <div class="category-content">
                    <i class="fas fa-atom"></i>
                    <h3>Ciencias B√°sicas</h3>
                    <p>F√≠sica, qu√≠mica y matem√°ticas</p>
                    <div class="category-stats">
                        <span>40 Laboratorios</span>
                        <span>100 Proyectos</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Resultados de B√∫squeda Global -->
    <div class="global-search-results" id="searchResults" style="display: none;">
        <div class="results-header">
            <h3>
                <i class="fas fa-search"></i>
                Resultados de B√∫squeda
            </h3>
            <button type="button" class="close-results" id="closeResults">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="results-tabs">
            <button class="tab-btn active" data-tab="all">
                <i class="fas fa-list"></i>
                Todos los Resultados
            </button>
            <button class="tab-btn" data-tab="laboratorios">
                <i class="fas fa-flask"></i>
                Laboratorios
            </button>
            <button class="tab-btn" data-tab="proyectos">
                <i class="fas fa-project-diagram"></i>
                Proyectos
            </button>
            <button class="tab-btn" data-tab="investigadores">
                <i class="fas fa-user-tie"></i>
                Investigadores
            </button>
            <button class="tab-btn" data-tab="instituciones">
                <i class="fas fa-university"></i>
                Instituciones
            </button>
        </div>
        
        <div class="results-content" id="resultsContent">
            <!-- Los resultados se cargar√°n aqu√≠ din√°micamente -->
            <div class="loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Buscando en todas las categor√≠as...</p>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript para funcionalidad -->
    <script>
document.addEventListener('DOMContentLoaded', function() {
    const globalSearchInput = document.getElementById('globalSearchInput');
    const clearGlobalSearch = document.getElementById('clearGlobalSearch');
    const globalSearchForm = document.getElementById('globalSearchForm');
    const searchResults = document.getElementById('searchResults');
    const closeResults = document.getElementById('closeResults');
    const resultsContent = document.getElementById('resultsContent');
    const tabBtns = document.querySelectorAll('.tab-btn');
    
    // Mostrar/ocultar bot√≥n de limpiar b√∫squeda
    globalSearchInput.addEventListener('input', function() {
        clearGlobalSearch.style.display = this.value ? 'block' : 'none';
    });
    
    // Limpiar b√∫squeda
    clearGlobalSearch.addEventListener('click', function() {
        globalSearchInput.value = '';
        this.style.display = 'none';
        searchResults.style.display = 'none';
    });
    
    // Cerrar resultados
    closeResults.addEventListener('click', function() {
        searchResults.style.display = 'none';
    });
    
    // Manejo de tabs
    tabBtns.forEach(btn => {
        btn.addEventListener('click', function() {
            tabBtns.forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            
            const tab = this.dataset.tab;
            filterResults(tab);
        });
    });
    
    // Env√≠o del formulario de b√∫squeda
    globalSearchForm.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const query = globalSearchInput.value.trim();
        if (!query) return;
        
        const selectedCategories = Array.from(document.querySelectorAll('input[name="categories"]:checked'))
            .map(cb => cb.value);
        
        if (selectedCategories.length === 0) {
            alert('Por favor selecciona al menos una categor√≠a para buscar.');
            return;
        }
        
        performGlobalSearch(query, selectedCategories);
    });
    
    // Funci√≥n para realizar b√∫squeda global
    function performGlobalSearch(query, categories) {
        searchResults.style.display = 'block';
        resultsContent.innerHTML = `
            <div class="loading-state">
                <i class="fas fa-spinner fa-spin"></i>
                <p>Buscando "${query}" en ${categories.join(', ')}...</p>
            </div>
        `;
        
        // Simular b√∫squeda (aqu√≠ conectar√≠as con tu backend)
        setTimeout(() => {
            const mockResults = generateMockResults(query, categories);
            displayResults(mockResults);
        }, 1500);
    }
    
    // Funci√≥n para generar resultados simulados
    function generateMockResults(query, categories) {
        const results = {
            laboratorios: [
                { id: 1, name: `Laboratorio de ${query}`, type: 'laboratorios', description: 'Laboratorio especializado en investigaci√≥n avanzada', institution: 'Universidad Nacional' },
                { id: 2, name: `Centro de ${query} Aplicado`, type: 'laboratorios', description: 'Centro de investigaci√≥n y desarrollo', institution: 'Instituto Tecnol√≥gico' }
            ],
            proyectos: [
                { id: 1, name: `Proyecto de investigaci√≥n en ${query}`, type: 'proyectos', description: 'Proyecto innovador de investigaci√≥n', leader: 'Dr. Juan P√©rez' },
                { id: 2, name: `Desarrollo de ${query} sostenible`, type: 'proyectos', description: 'Proyecto enfocado en sostenibilidad', leader: 'Dra. Mar√≠a Garc√≠a' }
            ],
            investigadores: [
                { id: 1, name: 'Dr. Carlos Rodr√≠guez', type: 'investigadores', specialty: `Especialista en ${query}`, institution: 'Universidad Central' },
                { id: 2, name: 'Dra. Ana L√≥pez', type: 'investigadores', specialty: `Experta en ${query} avanzado`, institution: 'Instituto de Investigaci√≥n' }
            ],
            instituciones: [
                { id: 1, name: `Instituto de ${query}`, type: 'instituciones', description: 'Instituto l√≠der en investigaci√≥n', location: 'Ciudad Capital' },
                { id: 2, name: `Universidad de ${query}`, type: 'instituciones', description: 'Universidad con programas especializados', location: 'Ciudad Universitaria' }
            ]
        };
        
        // Filtrar por categor√≠as seleccionadas
        const filteredResults = {};
        categories.forEach(cat => {
            if (results[cat]) {
                filteredResults[cat] = results[cat];
            }
        });
        
        return filteredResults;
    }
    
    // Funci√≥n para mostrar resultados
    function displayResults(results) {
        let html = '';
        
        Object.keys(results).forEach(category => {
            if (results[category].length > 0) {
                html += `
                    <div class="result-category" data-category="${category}">
                        <h4 class="category-title">
                            <i class="fas fa-${getCategoryIcon(category)}"></i>
                            ${getCategoryName(category)} (${results[category].length})
                        </h4>
                        <div class="result-items">
                `;
                
                results[category].forEach(item => {
                    html += `
                        <div class="result-item">
                            <div class="result-icon">
                                <i class="fas fa-${getCategoryIcon(category)}"></i>
                            </div>
                            <div class="result-content">
                                <h5>${item.name}</h5>
                                <p>${item.description || item.specialty}</p>
                                <div class="result-meta">
                                    ${item.institution ? `<span><i class="fas fa-university"></i> ${item.institution}</span>` : ''}
                                    ${item.leader ? `<span><i class="fas fa-user"></i> ${item.leader}</span>` : ''}
                                    ${item.location ? `<span><i class="fas fa-map-marker-alt"></i> ${item.location}</span>` : ''}
                                </div>
                            </div>
                            <div class="result-actions">
                                <button class="btn-view-result" onclick="viewDetails('${category}', ${item.id})">
                                    <i class="fas fa-eye"></i>
                                    Ver
                                </button>
                            </div>
                        </div>
                    `;
                });
                
                html += `
                        </div>
                    </div>
                `;
            }
        });
        
        if (html === '') {
            html = `
                <div class="no-results">
                    <i class="fas fa-search"></i>
                    <h4>No se encontraron resultados</h4>
                    <p>Intenta con otros t√©rminos de b√∫squeda o selecciona diferentes categor√≠as.</p>
                </div>
            `;
        }
        
        resultsContent.innerHTML = html;
    }
    
    // Funci√≥n para filtrar resultados por tab
    function filterResults(tab) {
        const categories = document.querySelectorAll('.result-category');
        
        categories.forEach(category => {
            if (tab === 'all' || category.dataset.category === tab) {
                category.style.display = 'block';
            } else {
                category.style.display = 'none';
            }
        });
    }
    
    // Funciones auxiliares
    function getCategoryIcon(category) {
        const icons = {
            laboratorios: 'flask',
            proyectos: 'project-diagram',
            investigadores: 'user-tie',
            instituciones: 'university',
            convocatorias: 'bullhorn',
            publicaciones: 'book'
        };
        return icons[category] || 'circle';
    }
    
    function getCategoryName(category) {
        const names = {
            laboratorios: 'Laboratorios',
            proyectos: 'Proyectos',
            investigadores: 'Investigadores',
            instituciones: 'Instituciones',
            convocatorias: 'Convocatorias',
            publicaciones: 'Publicaciones'
        };
        return names[category] || category;
    }
    
    // Funci√≥n global para ver detalles
    window.viewDetails = function(category, id) {
        // Aqu√≠ redirigir√≠as a la p√°gina de detalles correspondiente
        if (category === 'laboratorios') {
            window.location.href = `/laboratorio/${id}`;
        } else {
            alert(`Ver detalles de ${category} ID: ${id}`);
        }
    };
        });
    </script>

    <!-- Script para manejo de localStorage del usuario -->
    <script src="{{ url_for('static', filename='js/user-storage.js') }}"></script>
    <script>
        // Ejemplo de uso del sistema localStorage
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üè† P√°gina home cargada');
            
            // Verificar si el usuario est√° logueado
            if (UserStorage.isLoggedIn()) {
                console.log('‚úÖ Usuario logueado detectado desde localStorage');
                
                // Obtener informaci√≥n b√°sica del usuario
                const userInfo = UserStorage.getBasicInfo();
                if (userInfo) {
                    console.log('üë§ Usuario:', userInfo.name);
                    console.log('üè∑Ô∏è Rol:', userInfo.role);
                    console.log('üìß Email:', userInfo.email);
                    console.log('üè¢ Instituci√≥n:', userInfo.institution);
                    console.log('üéØ √Årea:', userInfo.area);
                    
                    // Actualizar elementos de la p√°gina con datos del usuario
                    updateUserInterface(userInfo);
                }
                
                // Mostrar estad√≠sticas de sesi√≥n
                const stats = UserStorage.getStorageStats();
                console.log('üìä Estad√≠sticas de sesi√≥n:', stats);
                
                // Verificar si la sesi√≥n ha expirado (8 horas)
                if (UserStorage.isSessionExpired(480)) {
                    console.warn('‚ö†Ô∏è Sesi√≥n expirada');
                    // Aqu√≠ podr√≠as mostrar un modal o redirigir
                }
            } else {
                console.log('‚ùå Usuario no est√° logueado');
            }
        });
        
        function updateUserInterface(userInfo) {
            // Actualizar elementos de la p√°gina con informaci√≥n del usuario
            try {
                // Actualizar nombre del usuario en la interfaz
                const userNameElements = document.querySelectorAll('.user-name');
                userNameElements.forEach(element => {
                    element.textContent = userInfo.name;
                });
                
                // Actualizar rol del usuario
                const userRoleElements = document.querySelectorAll('.user-role');
                userRoleElements.forEach(element => {
                    element.textContent = userInfo.role;
                });
                
                // Actualizar avatar del usuario
                const userAvatarElements = document.querySelectorAll('.user-avatar');
                userAvatarElements.forEach(element => {
                    if (userInfo.avatar) {
                        element.src = userInfo.avatar;
                    }
                });
                
                // Mostrar elementos espec√≠ficos seg√∫n el rol
                if (userInfo.role === 'Super Administrador' || userInfo.role === 'Administrador') {
                    document.body.classList.add('admin-user');
                    const adminElements = document.querySelectorAll('.admin-only');
                    adminElements.forEach(element => {
                        element.style.display = 'block';
                    });
                }
                
                // Personalizar saludo seg√∫n la hora
                const greeting = getGreeting();
                const greetingElements = document.querySelectorAll('.user-greeting');
                greetingElements.forEach(element => {
                    element.textContent = `${greeting}, ${userInfo.name.split(' ')[0]}`;
                });
                
                console.log('‚úÖ Interfaz actualizada con datos del usuario');
                
            } catch (error) {
                console.error('‚ùå Error actualizando interfaz:', error);
            }
        }
        
        function getGreeting() {
            const hour = new Date().getHours();
            if (hour < 12) return 'Buenos d√≠as';
            if (hour < 18) return 'Buenas tardes';
            return 'Buenas noches';
        }
        
        // Escuchar eventos del sistema de localStorage
        window.addEventListener('userLoggedIn', function(e) {
            console.log('üéâ Usuario logueado:', e.detail);
            // Recargar p√°gina o actualizar interfaz
        });
        
        window.addEventListener('userLoggedOut', function(e) {
            console.log('üëã Usuario deslogueado:', e.detail);
            // Limpiar interfaz
            document.body.classList.remove('admin-user');
        });
        
        window.addEventListener('userDataUpdated', function(e) {
            console.log('üîÑ Datos actualizados:', e.detail.key, '=', e.detail.value);
            // Actualizar interfaz seg√∫n el dato modificado
        });
        
        // Funci√≥n para mostrar informaci√≥n del usuario en consola (para debugging)
        window.showUserInfo = function() {
            console.log('üìã INFORMACI√ìN DEL USUARIO:');
            console.log('¬øLogueado?', UserStorage.isLoggedIn());
            console.log('Datos completos:', UserStorage.get());
            console.log('Info b√°sica:', UserStorage.getBasicInfo());
            console.log('Estad√≠sticas:', UserStorage.getStorageStats());
            console.table(UserStorage.getStorageStats());
        };
        
        // Funci√≥n para limpiar datos del usuario (para debugging)
        window.clearUserData = function() {
            UserStorage.clearAll();
            console.log('üßπ Datos del usuario eliminados');
        };
        
        console.log('‚úÖ Sistema localStorage inicializado en home.html');
        console.log('üí° Usa showUserInfo() para ver informaci√≥n del usuario');
        console.log('üí° Usa clearUserData() para limpiar datos de prueba');
    </script>
{% endblock %}
